<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.5/css/mdb.min.css" rel="stylesheet">

  <!-- <link rel="stylesheet" href="./style.css"/> -->
</head>
<body>

  <h1>MySQL create user and role</h1>
  <div id="app" class="">
    <h2>First, check already users</h2>
    <div class="col-md-12">
      <div class="md-form">
        <span class="col-md-2">
          <a class="copy btn btn-default waves-effect waves-light" :data-clipboard-text="showUserList">Copy</a>
        </span>
        <input v-model="showUserList" type="text" class="col-md-8"/>
      </div>
    </div>


    <h2>1. Input parameter</h2>
    <div class="col-md-6">
      <div class="md-form">
        <i class="fas fa-database prefix"></i>
        <input v-model="dbname" type="text" class="form-control mb-4" ref="targetDb" @click="$refs.targetDb.select()"/>
        <label for="dbname" class="active">database</label>
      </div>
    </div>

    <div class="col-md-6">
      <div class="md-form">
        <i class="fas fa-user prefix"></i>
        <input v-model="username" type="text" class="form-control mb-4" ref="targetUser" @click="$refs.targetUser.select()"/>
        <label for="username" class="active">user</label>
      </div>
    </div>

    <div class="col-md-6">
      <div class="md-form">
        <i class="fas fa-laptop prefix"></i>
        <input v-model="hostname" type="text" class="form-control mb-4" ref="targetHost" @click="$refs.targetHost.select()"/>
        <label for="hostname" class="active">host</label>
      </div>
    </div>

    <div class="col-md-6">
      <div class="md-form">
        <i class="fas fa-lock prefix"></i>
        <input v-model="password" type="text" class="form-control mb-4" ref="targetPswd" @click="$refs.targetPswd.select()"/>
        <label for="password" class="active">password</label>
      </div>
    </div>

    <h2>2. Commands...</h2>

    <h3>Create user with role(Role: DB FULL)</h3>
    <div class="col-md-12">
      <div class="md-form">
        <span class="col-md-2">
          <a class="copy btn btn-default waves-effect waves-light" :data-clipboard-text="createFullUser">Copy</a>
        </span>
        <input v-model="createFullUser" type="text" class="col-md-8"/>
      </div>
    </div>

    <h3>Create user with role(Role: table CRUD)</h3>
    <div class="col-md-12">
      <div class="md-form">
        <span class="col-md-2">
          <a class="copy btn btn-default waves-effect waves-light" :data-clipboard-text="createCrudUser">Copy</a>
        </span>
        <input v-model="createCrudUser" type="text" class="col-md-8"/>
      </div>
    </div>

    <h3>Check you were created user</h3>
    <div class="col-md-12">
      <div class="md-form">
        <span class="col-md-2">
          <a class="copy btn btn-default waves-effect waves-light" :data-clipboard-text="showUserList">Copy</a>
        </span>
        <input v-model="showUserList" type="text" class="col-md-8"/>
      </div>
    </div>

    <div class="col-md-12">
      <div class="md-form">
        <span class="col-md-2">
          <a class="copy btn btn-default waves-effect waves-light" :data-clipboard-text="showGrant">Copy</a>
        </span>
        <input v-model="showGrant" type="text" class="col-md-8"/>
      </div>
    </div>

    <hr>

    <h3>Change Password</h3>
    <div class="col-md-12">
      <div class="md-form">
        <span class="col-md-2">
          <a class="copy btn btn-default waves-effect waves-light" :data-clipboard-text="changePswd">Copy</a>
        </span>
        <input v-model="changePswd" type="text" class="col-md-8"/>
      </div>
    </div>

    <h3>Drop user</h3>
    <div class="col-md-12">
      <div class="md-form">
        <span class="col-md-2">
          <a class="copy btn btn-default waves-effect waves-light" :data-clipboard-text="dropUser">Copy</a>
        </span>
        <input v-model="dropUser" type="text" class="col-md-8"/>
      </div>
    </div>
  </div>

<!-- JQuery -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.5/js/mdb.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.9/vue.js"></script>

<script>
    var clipboard = new Clipboard('.copy');

    clipboard.on('success', function(e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);

        e.clearSelection();
    });

    var app =   new Vue({
        el: "#app",
        data: {
            dbname: '',
            username: '',
            hostname: '',
            password: '',
        },
        methods: {},
        computed: {
            createFullUser: function () {
                var sql = "#COMMAND# #ROLE# `#DB#`.* TO `#USER#`@`#HOST#` IDENTIFIED BY '#PSWD#';";
                var command = "GRANT";
                var role = "ALL PRIVILEGES ON";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#ROLE#', role);
                sql = sql.replace('#DB#', this.dbname);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);
                sql = sql.replace('#PSWD#', this.password);

                return sql;
            },
            createCrudUser: function () {
                var sql = "#COMMAND# #ROLE# `#DB#`.* TO `#USER#`@`#HOST#` IDENTIFIED BY '#PSWD#';";
                var command = "GRANT";
                var role = "SELECT,UPDATE,INSERT,DELETE";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#ROLE#', role);
                sql = sql.replace('#DB#', this.dbname);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);
                sql = sql.replace('#PSWD#', this.password);

                return sql;
            },
            showUserList: function () {
                var sql = "SELECT user,host FROM mysql.user;";
                return sql;
            },
            showGrant: function () {
                var sql = "#COMMAND# `#USER#`@`#HOST#`;";
                var command = "SHOW GRANTS FOR";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);

                return sql;
            },
            changePswd: function () {
                var sql = "#COMMAND# `#USER#`@`#HOST#`=password('#PSWD#');";
                var command = "SET PASSWORD FOR";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);
                sql = sql.replace('#PSWD#', this.password);

                return sql;
            },
            dropUser: function () {
                var sql = "#COMMAND# `#USER#`@`#HOST#`;";
                var command = "DROP user";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);

                return sql;
            }
        }
    });
  </script>
</body>
</html>
