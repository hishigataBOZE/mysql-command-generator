<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.5/css/mdb.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
  <link rel="stylesheet" href="./style.css"/>
</head>
<body>

<section class="text-left border border-light p-5">

  <h1>MySQL create user and role</h1>
  <div id="app">
    <h2>First, check already users</h2>
    <input type="text" name="show_user_list" class="form-control mb-4" v-model="showUserList"/>
    <br/>
    <br/>

    <h2>1. Input parameter</h2>
    <p>
      <input v-model="dbname" type="text" class="form-control mb-4" placeholder="database"/>
      <input v-model="username" type="text" class="form-control mb-4" placeholder="username"/>
      <input v-model="hostname" type="text" class="form-control mb-4" placeholder="hostname"/>
      <input v-model="password" type="text" class="form-control mb-4" placeholder="password"/>
    </p>
    <hr>

    <h2>2. Commands...</h2>

    <h3>Create user with role(Role: DB FULL)</h3>
    <input v-model="createFullUser" type="text" class="form-control mb-4"/>
    <button class="btn" :data-clipboard-text="createFullUser">Copy</button>

    <h3>Create user with role(Role: table CRUD)</h3>
    <input v-model="createCrudUser" type="text" class="form-control mb-4"/>

    <h3>Check you were created user</h3>
    <input v-model="showUserList" type="text" class="form-control mb-4"/>
    <input v-model="showGrant" type="text" class="form-control mb-4"/>

    <hr>

    <h3>Change Password</h3>
    <input v-model="changePswd" type="text" class="form-control mb-4"/>

    <h3>Drop user</h3>
    <input v-model="changePswd" type="text" class="form-control mb-4"/>
  </div>


</section>

<!-- JQuery -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.5/js/mdb.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.9/vue.js"></script>

<script>
    var clipboard = new Clipboard('.btn');

    clipboard.on('success', function(e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);

        e.clearSelection();
    });

    var app =   new Vue({
        el: "#app",
        data: {
            dbname: 'database',
            username: 'username',
            hostname: 'hostname',
            password: 'password',
        },
        methods: {},
        computed: {
            createFullUser: function () {
                var sql = "#COMMAND# #ROLE# `#DB#`.* TO `#USER#`@`#HOST#` IDENTIFIED BY '#PSWD#';";
                var command = "GRANT";
                var role = "ALL PRIVILEGES ON";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#ROLE#', role);
                sql = sql.replace('#DB#', this.dbname);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);
                sql = sql.replace('#PSWD#', this.password);

                return sql;
            },
            createCrudUser: function () {
                var sql = "#COMMAND# #ROLE# `#DB#`.* TO `#USER#`@`#HOST#` IDENTIFIED BY '#PSWD#';";
                var command = "GRANT";
                var role = "SELECT,UPDATE,INSERT,DELETE";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#ROLE#', role);
                sql = sql.replace('#DB#', this.dbname);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);
                sql = sql.replace('#PSWD#', this.password);

                return sql;
            },
            showUserList: function () {
                var sql = "SELECT user,host FROM mysql.user;";
                return sql;
            },
            showGrant: function () {
                var sql = "#COMMAND# `#USER#`@`#HOST#`;";
                var command = "SHOW GRANTS FOR";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);

                return sql;
            },
            changePswd: function () {
                var sql = "#COMMAND# `#USER#`@`#HOST#`=password('#PSWD#');";
                var command = "SET PASSWORD FOR";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);
                sql = sql.replace('#PSWD#', this.password);

                return sql;
            },
            dropUser: function () {
                var sql = "#COMMAND# `#USER#`@`#HOST#`;";
                var command = "DROP user";

                sql = sql.replace('#COMMAND#', command);
                sql = sql.replace('#USER#', this.username);
                sql = sql.replace('#HOST#', this.hostname);

                return sql;
            }
        }
    });
  </script>
</body>
</html>
